<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Sanmati School Election 2025 - Group 2</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Poppins', sans-serif;
            background: linear-gradient(135deg, #1e3c72, #2a5298);
            color: #f3f4f6;
            overflow-x: hidden;
        }
        .header-container {
            animation: fadeInDown 1s ease-out;
        }
        @keyframes fadeInDown {
            from { opacity: 0; transform: translateY(-20px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .slogan {
            animation: slideIn 2s ease-in-out infinite alternate;
        }
        @keyframes slideIn {
            from { transform: translateX(-15px); }
            to { transform: translateX(15px); }
        }
        .candidate-intro {
            animation: bounceIn 1s ease-out;
            background: linear-gradient(135deg, #ffffff10, #ffffff20);
            border: 2px solid transparent;
            border-radius: 10px;
            background-clip: padding-box;
            position: relative;
        }
        @keyframes bounceIn {
            from { transform: scale(0.8); opacity: 0; }
            to { transform: scale(1); opacity: 1; }
        }
        .candidate-intro::before {
            content: '';
            position: absolute;
            top: -2px; left: -2px; right: -2px; bottom: -2px;
            background: linear-gradient(45deg, #ff6b6b, #4ecdc4, #45b7d1);
            border-radius: 12px;
            z-index: -1;
            filter: blur(8px);
            animation: glow 4s ease-in-out infinite;
        }
        @keyframes glow {
            0% { opacity: 0.7; }
            50% { opacity: 1; }
            100% { opacity: 0.7; }
        }
        .candidate-img {
            width: 100px;
            height: 100px;
            object-fit: cover;
            border-radius: 50%;
            border: 4px solid #fff;
            box-shadow: 0 0 15px rgba(255, 255, 255, 0.3);
            transition: transform 0.3s, box-shadow 0.3s;
        }
        .candidate-img:hover {
            transform: scale(1.15);
            box-shadow: 0 0 25px rgba(255, 107, 107, 0.7);
        }
        .custom-select {
            appearance: none;
            background: #fff url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' fill='%231e3c72' viewBox='0 0 16 16'%3E%3Cpath d='M7.247 11.14 2.451 5.658C1.885 5.013 2.345 4 3.204 4h9.592a1 1 0 0 1 .753 1.659l-4.796 5.48a1 1 0 0 1-1.506 0z'/%3E%3C/svg%3E") no-repeat right 0.75rem center;
            padding: 0.75rem 2rem 0.75rem 1rem;
            border: 2px solid #4ecdc4;
            border-radius: 8px;
            font-size: 1rem;
            cursor: pointer;
            width: 100%;
            background-color: #f9fafb;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(78, 205, 196, 0.4); }
            70% { box-shadow: 0 0 0 10px rgba(78, 205, 196, 0); }
            100% { box-shadow: 0 0 0 0 rgba(78, 205, 196, 0); }
        }
        .custom-select:focus {
            outline: none;
            border-color: #45b7d1;
            box-shadow: 0 0 0 3px rgba(69, 183, 209, 0.5);
        }
        .vote-btn {
            background: linear-gradient(45deg, #ff6b6b, #feca57);
            transition: background 0.3s, transform 0.3s, box-shadow 0.3s;
            position: relative;
            overflow: hidden;
        }
        .vote-btn::after {
            content: '';
            position: absolute;
            top: 50%; left: 50%;
            width: 0; height: 0;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 50%;
            transform: translate(-50%, -50%);
            transition: width 0.6s, height 0.6s;
        }
        .vote-btn:hover::after {
            width: 300px;
            height: 300px;
        }
        .vote-btn:hover {
            background: linear-gradient(45deg, #feca57, #ff6b6b);
            transform: translateY(-3px);
            box-shadow: 0 6px 20px rgba(255, 107, 0, 0.4);
        }
        .progress-bar {
            height: 10px;
            background-color: #4ecdc4;
            border-radius: 5px;
            transition: width 0.3s;
        }
        .modal {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            z-index: 1000;
        }
        .modal-content {
            background: #fff;
            padding: 2rem;
            border-radius: 10px;
            max-width: 500px;
            width: 90%;
            color: #1e3c72;
        }
        .tooltip {
            cursor: help;
            color: #4ecdc4;
            margin-left: 5px;
        }
        @media (max-width: 640px) {
            .candidate-intro {
                padding: 1rem;
            }
            .custom-select {
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body class="min-h-screen flex flex-col items-center justify-center p-4">
    <header class="header-container text-center mb-12">
        <img src="https://placehold.co/200x100?text=Sanmati+School+Logo" alt="Sanmati Higher Secondary School Logo" class="mx-auto mb-4" style="max-width: 200px; border-radius: 10px; box-shadow: 0 0 15px rgba(255, 255, 255, 0.5);">
        <h1 class="text-5xl font-extrabold text-white animate-pulse">Sanmati School Election 2025 - Group 2</h1>
        <p class="text-2xl text-yellow-300 mt-4 slogan">Shape Tomorrow, Vote Today!</p>
    </header>
    <section class="w-full max-w-4xl mt-12">
        <h2 class="text-3xl font-bold text-center text-white mb-6">Meet Your Candidates</h2>
        <div class="grid grid-cols-1 sm:grid-cols-3 md:grid-cols-5 gap-4 mb-12">
            <div class="candidate-intro text-center p-2 rounded-lg">
                <img src="https://placehold.co/100x100?text=Candidate1" alt="Candidate 1" class="candidate-img mx-auto">
                <h3 class="text-lg font-semibold mt-2 text-white">Candidate 1</h3>
                <p class="text-sm text-gray-200 mt-1">Running for School President</p>
            </div>
            <div class="candidate-intro text-center p-2 rounded-lg">
                <img src="https://placehold.co/100x100?text=Candidate2" alt="Candidate 2" class="candidate-img mx-auto">
                <h3 class="text-lg font-semibold mt-2 text-white">Candidate 2</h3>
                <p class="text-sm text-gray-200 mt-1">Running for School President</p>
            </div>
            <div class="candidate-intro text-center p-2 rounded-lg">
                <img src="https://placehold.co/100x100?text=Candidate3" alt="Candidate 3" class="candidate-img mx-auto">
                <h3 class="text-lg font-semibold mt-2 text-white">Candidate 3</h3>
                <p class="text-sm text-gray-200 mt-1">Running for Vice President</p>
            </div>
            <div class="candidate-intro text-center p-2 rounded-lg">
                <img src="https://placehold.co/100x100?text=Candidate4" alt="Candidate 4" class="candidate-img mx-auto">
                <h3 class="text-lg font-semibold mt-2 text-white">Candidate 4</h3>
                <p class="text-sm text-gray-200 mt-1">Running for Vice President</p>
            </div>
            <div class="candidate-intro text-center p-2 rounded-lg">
                <img src="https://placehold.co/100x100?text=Candidate5" alt="Candidate 5" class="candidate-img mx-auto">
                <h3 class="text-lg font-semibold mt-2 text-white">Candidate 5</h3>
                <p class="text-sm text-gray-200 mt-1">Running for Prime Minister</p>
            </div>
            <!-- Add more candidates as needed for other positions -->
        </div>
    </section>
    <section class="w-full max-w-4xl mt-12 bg-white/10 backdrop-blur-md rounded-lg shadow-lg p-6 border border-white/20">
        <h2 class="text-3xl font-bold text-center text-white mb-6">Cast Your Vote</h2>
        <div class="w-full bg-gray-200 rounded-full h-2.5 mb-4">
            <div id="progress-bar" class="progress-bar h-2.5 rounded-full" style="width: 0%"></div>
        </div>
        <form id="voteForm" class="space-y-4">
            <div>
                <label for="name" class="block text-gray-200 font-medium">Full Name</label>
                <input type="text" id="name" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-4ecdc4 bg-white/80">
            </div>
            <div>
                <label for="class" class="block text-gray-200 font-medium">Class</label>
                <select id="class" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-4ecdc4 bg-white/80">
                    <option value="">--Choose Class--</option>
                    <option value="12">12</option>
                    <option value="11">11</option>
                    <option value="9-10">9 & 10</option>
                </select>
            </div>
            <div id="sectionDiv" style="display: none;">
                <label for="section" class="block text-gray-200 font-medium">Section</label>
                <select id="section" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-4ecdc4 bg-white/80">
                    <option value="">--Choose Section--</option>
                    <option value="A">A</option>
                    <option value="B">B</option>
                    <option value="C">C</option>
                    <option value="D">D</option>
                </select>
            </div>
            <div>
                <label for="scholarNo" class="block text-gray-200 font-medium">Scholar Number</label>
                <input type="text" id="scholarNo" required class="w-full p-2 border border-gray-300 rounded-md focus:outline-none focus:ring-2 focus:ring-4ecdc4 bg-white/80">
            </div>
            <div id="votingPosts" class="space-y-4">
                <!-- Voting posts will be dynamically inserted here -->
            </div>
            <div class="flex justify-between">
                <button id="prevBtn" type="button" class="vote-btn w-1/3 py-2 text-white font-semibold rounded-md text-lg mt-4 hidden">Previous</button>
                <button id="nextBtn" type="button" class="vote-btn w-1/3 py-2 text-white font-semibold rounded-md text-lg mt-4">Next</button>
                <button id="submitBtn" type="submit" class="vote-btn w-1/3 py-2 text-white font-semibold rounded-md text-lg mt-4 hidden">Submit Vote</button>
            </div>
        </form>
        <a href="admin-control.html" class="block text-center mt-4 text-4ecdc4 hover:text-45b7d1 hover:underline text-lg font-medium">View Election Results</a>
    </section>
    <footer class="mt-12 text-center text-white/80 text-lg">© 2025 Sanmati Higher Secondary School. All rights reserved.</footer>

    <script type="module">
        import { initializeApp, deleteApp, getApps } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getFirestore, collection, doc, setDoc, getDocs, query, where, getDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        const firebaseConfig = {
  apiKey: "AIzaSyBLN3ENTtU1clKiY3ayKym4p2hFCsSw1ts",
  authDomain: "school-voting-492f0.firebaseapp.com",
  projectId: "school-voting-492f0",
  storageBucket: "school-voting-492f0.firebasestorage.app",
  messagingSenderId: "1067824236088",
  appId: "1:1067824236088:web:867393ecd32b0708bec8cd",
  measurementId: "G-F8J7CRVNPE"
};

        let app;
        if (getApps().length) {
            getApps().forEach(a => deleteApp(a));
        }
        app = initializeApp(firebaseConfig);
        const db = getFirestore(app);

        const posts = [
            {
                id: "post1",
                label: "School President",
                tooltip: "Leads the student council and represents the school.",
                candidates: [
                    { name: "Candidate 1", image: "https://placehold.co/100x100?text=Candidate1" },
                    { name: "Candidate 2", image: "https://placehold.co/100x100?text=Candidate2" }
                ]
            },
            {
                id: "post2",
                label: "Vice President",
                tooltip: "Assists the president and leads in their absence.",
                candidates: [
                    { name: "Candidate 3", image: "https://placehold.co/100x100?text=Candidate3" },
                    { name: "Candidate 4", image: "https://placehold.co/100x100?text=Candidate4" }
                ]
            },
            {
                id: "post3",
                label: "Prime Minister",
                tooltip: "Oversees major school initiatives.",
                candidates: [
                    { name: "Candidate 5", image: "https://placehold.co/100x100?text=Candidate5" },
                    { name: "Candidate 6", image: "https://placehold.co/100x100?text=Candidate6" }
                ]
            },
            {
                id: "post4",
                label: "Deputy P.M.",
                tooltip: "Supports the Prime Minister.",
                candidates: [
                    { name: "Candidate 7", image: "https://placehold.co/100x100?text=Candidate7" },
                    { name: "Candidate 8", image: "https://placehold.co/100x100?text=Candidate8" }
                ]
            },
            {
                id: "post5",
                label: "Discipline Advisor",
                tooltip: "Promotes discipline and school rules.",
                candidates: [
                    { name: "Candidate 9", image: "https://placehold.co/100x100?text=Candidate9" },
                    { name: "Candidate 10", image: "https://placehold.co/100x100?text=Candidate10" }
                ]
            },
            {
                id: "post6",
                label: "Speaker",
                tooltip: "Represents student voices in assemblies.",
                candidates: [
                    { name: "Candidate 11", image: "https://placehold.co/100x100?text=Candidate11" },
                    { name: "Candidate 12", image: "https://placehold.co/100x100?text=Candidate12" }
                ]
            },
            {
                id: "post7",
                label: "House Captain Class 10 (1 per House)",
                tooltip: "Leads Class 10 house activities.",
                classSpecific: "9-10",
                candidates: [
                    { name: "Candidate 13", image: "https://placehold.co/100x100?text=Candidate13" },
                    { name: "Candidate 14", image: "https://placehold.co/100x100?text=Candidate14" }
                ]
            },
            {
                id: "post8",
                label: "Vice-Captain Class 9 (1 per House)",
                tooltip: "Supports Class 9 house leadership.",
                classSpecific: "9-10",
                candidates: [
                    { name: "Candidate 15", image: "https://placehold.co/100x100?text=Candidate15" },
                    { name: "Candidate 16", image: "https://placehold.co/100x100?text=Candidate16" }
                ]
            },
            {
                id: "post9",
                label: "Sports Captain Class 9 (1 per House)",
                tooltip: "Leads Class 9 sports activities.",
                classSpecific: "9-10",
                candidates: [
                    { name: "Candidate 17", image: "https://placehold.co/100x100?text=Candidate17" },
                    { name: "Candidate 18", image: "https://placehold.co/100x100?text=Candidate18" }
                ]
            },
            {
                id: "post10",
                label: "Class Representative Class 10 (4 Positions)",
                tooltip: "Represents Class 10 students.",
                classSpecific: "9-10",
                candidates: [
                    { name: "Candidate 19", image: "https://placehold.co/100x100?text=Candidate19" },
                    { name: "Candidate 20", image: "https://placehold.co/100x100?text=Candidate20" }
                ]
            },
            {
                id: "post11",
                label: "Cultural Advisor",
                tooltip: "Promotes cultural events.",
                candidates: [
                    { name: "Candidate 21", image: "https://placehold.co/100x100?text=Candidate21" },
                    { name: "Candidate 22", image: "https://placehold.co/100x100?text=Candidate22" }
                ]
            },
            {
                id: "post12",
                label: "Cultural Minister",
                tooltip: "Organizes cultural programs.",
                candidates: [
                    { name: "Candidate 23", image: "https://placehold.co/100x100?text=Candidate23" },
                    { name: "Candidate 24", image: "https://placehold.co/100x100?text=Candidate24" }
                ]
            },
            {
                id: "post13",
                label: "Technological Advisor",
                tooltip: "Guides tech-related initiatives.",
                candidates: [
                    { name: "Candidate 25", image: "https://placehold.co/100x100?text=Candidate25" },
                    { name: "Candidate 26", image: "https://placehold.co/100x100?text=Candidate26" }
                ]
            },
            {
                id: "post14",
                label: "Technological Minister",
                tooltip: "Implements tech solutions.",
                candidates: [
                    { name: "Candidate 27", image: "https://placehold.co/100x100?text=Candidate27" },
                    { name: "Candidate 28", image: "https://placehold.co/100x100?text=Candidate28" }
                ]
            },
            {
                id: "post15",
                label: "Academic Minister",
                tooltip: "Focuses on academic excellence.",
                candidates: [
                    { name: "Candidate 29", image: "https://placehold.co/100x100?text=Candidate29" },
                    { name: "Candidate 30", image: "https://placehold.co/100x100?text=Candidate30" }
                ]
            },
            {
                id: "post16",
                label: "Chairmen of House",
                tooltip: "Oversees house activities.",
                candidates: [
                    { name: "Candidate 31", image: "https://placehold.co/100x100?text=Candidate31" },
                    { name: "Candidate 32", image: "https://placehold.co/100x100?text=Candidate32" }
                ]
            },
            {
                id: "post17",
                label: "Environment Minister",
                tooltip: "Promotes environmental initiatives.",
                candidates: [
                    { name: "Candidate 33", image: "https://placehold.co/100x100?text=Candidate33" },
                    { name: "Candidate 34", image: "https://placehold.co/100x100?text=Candidate34" }
                ]
            }
        ];

        let currentStep = 0;
        const votingPostsDiv = document.getElementById('votingPosts');
        const prevBtn = document.getElementById('prevBtn');
        const nextBtn = document.getElementById('nextBtn');
        const submitBtn = document.getElementById('submitBtn');
        const progressBar = document.getElementById('progress-bar');

        function updatePosts() {
            console.log('updatePosts called');
            const classValue = document.getElementById('class').value;
            const sectionDiv = document.getElementById('sectionDiv');
            votingPostsDiv.innerHTML = '';
            currentStep = 0;

            sectionDiv.style.display = classValue ? 'block' : 'none';
            const filteredPosts = posts.filter(post => !post.classSpecific || post.classSpecific === classValue);
            console.log('Filtered Posts:', filteredPosts, 'Class:', classValue);
            if (filteredPosts.length === 0) {
                votingPostsDiv.innerHTML = '<p class="text-red-300">Please select a valid class to continue.</p>';
                return;
            }

            renderPost(filteredPosts[0]);
            updateProgress(filteredPosts);
            prevBtn.classList.add('hidden');
            nextBtn.classList.remove('hidden');
            submitBtn.classList.add('hidden');
        }

        function renderPost(post) {
            console.log('Rendering post:', post);
            votingPostsDiv.innerHTML = `
                <div class="mb-4">
                    <label for="${post.id}" class="block text-gray-200 font-medium">${post.label} <span class="tooltip" title="${post.tooltip}">ℹ️</span></label>
                    <div class="flex items-center space-x-4">
                        <select id="${post.id}" class="custom-select" required>
                            <option value="" disabled selected>--Choose a Candidate--</option>
                            ${post.candidates.map(c => `<option value="${c.name}" data-image="${c.image}">${c.name}</option>`).join('')}
                        </select>
                        <img class="candidate-img-preview hidden w-12 h-12 rounded-full border-2 border-white" src="" alt="Candidate">
                    </div>
                </div>
            `;
            updateCandidateOptions();
            const select = document.getElementById(post.id);
            if (select) {
                select.addEventListener('change', () => {
                    const imgUrl = select.options[select.selectedIndex]?.getAttribute('data-image');
                    const img = select.parentElement.querySelector('.candidate-img-preview');
                    if (imgUrl && select.value) {
                        img.src = imgUrl;
                        img.classList.remove('hidden');
                    } else {
                        img.classList.add('hidden');
                    }
                    updateCandidateOptions();
                });
            } else {
                console.error('Select element not found for post:', post.id);
            }
        }

        function updateCandidateOptions() {
            const selects = document.querySelectorAll('.custom-select');
            const selectedValues = new Set();
            selects.forEach(select => {
                if (select.value && select.value !== '') {
                    selectedValues.add(select.value);
                }
            });
            selects.forEach(select => {
                Array.from(select.options).forEach(option => {
                    if (selectedValues.has(option.value) && option.value !== '' && select.value !== option.value) {
                        option.disabled = true;
                    } else {
                        option.disabled = false;
                    }
                });
            });
        }

        function updateProgress(filteredPosts) {
            const progress = ((currentStep + 1) / filteredPosts.length) * 100;
            progressBar.style.width = `${progress}%`;
        }

        nextBtn.addEventListener('click', () => {
            console.log('Next button clicked, currentStep:', currentStep);
            const classValue = document.getElementById('class').value;
            if (!classValue) {
                alert('Please select a class before proceeding.');
                return;
            }
            const filteredPosts = posts.filter(post => !post.classSpecific || post.classSpecific === classValue);
            if (filteredPosts.length === 0) {
                alert('No posts available for the selected class.');
                return;
            }
            const currentPost = filteredPosts[currentStep];
            const select = document.getElementById(currentPost.id);
            if (!select) {
                console.error('Select element not found for post:', currentPost.id);
                alert('An error occurred. Please try again.');
                return;
            }
            if (!select.value) {
                alert('Please select a candidate for this position.');
                return;
            }
            currentStep++;
            if (currentStep < filteredPosts.length) {
                renderPost(filteredPosts[currentStep]);
                updateProgress(filteredPosts);
                prevBtn.classList.remove('hidden');
            } else {
                showSummary(filteredPosts);
                nextBtn.classList.add('hidden');
                submitBtn.classList.remove('hidden');
                prevBtn.classList.remove('hidden');
            }
        });

        prevBtn.addEventListener('click', () => {
            console.log('Previous button clicked, currentStep:', currentStep);
            const classValue = document.getElementById('class').value;
            const filteredPosts = posts.filter(post => !post.classSpecific || post.classSpecific === classValue);
            currentStep--;
            renderPost(filteredPosts[currentStep]);
            updateProgress(filteredPosts);
            nextBtn.classList.remove('hidden');
            submitBtn.classList.add('hidden');
            if (currentStep === 0) {
                prevBtn.classList.add('hidden');
            }
        });

        function showSummary(filteredPosts) {
            console.log('Showing summary for posts:', filteredPosts);
            votingPostsDiv.innerHTML = `
                <div class="modal-content">
                    <h3 class="text-2xl font-bold mb-4">Review Your Votes</h3>
                    ${filteredPosts.map(post => {
                        const select = document.getElementById(post.id);
                        return select ? `<p><strong>${post.label}:</strong> ${select.value || 'Not selected'}</p>` : '';
                    }).join('')}
                    <div class="mt-4 flex justify-end space-x-2">
                        <button type="button" class="vote-btn py-2 px-4 text-white font-semibold rounded-md" onclick="goBack()">Edit</button>
                        <button type="button" class="vote-btn py-2 px-4 text-white font-semibold rounded-md" onclick="submitForm()">Confirm</button>
                    </div>
                </div>
            `;
        }

        window.goBack = function() {
            console.log('Go back called, currentStep:', currentStep);
            const classValue = document.getElementById('class').value;
            const filteredPosts = posts.filter(post => !post.classSpecific || post.classSpecific === classValue);
            currentStep--;
            renderPost(filteredPosts[currentStep]);
            updateProgress(filteredPosts);
            nextBtn.classList.remove('hidden');
            submitBtn.classList.add('hidden');
            if (currentStep === 0) {
                prevBtn.classList.add('hidden');
            }
        };

        window.submitForm = function() {
            console.log('Submit form called');
            document.getElementById('voteForm').dispatchEvent(new Event('submit'));
        };

        async function validateScholarNo() {
            const scholarNo = document.getElementById('scholarNo').value;
            const classVal = document.getElementById('class').value;
            const section = document.getElementById('section').value || 'N/A';
            const classSection = `${classVal}${section !== 'N/A' ? section : ''}`;
            try {
                const scholarDoc = await getDoc(doc(db, `classes/${classSection}/students`, scholarNo));
                return scholarDoc.exists();
            } catch (error) {
                console.error('Validation error:', error);
                return false;
            }
        }

        document.getElementById('voteForm').addEventListener('submit', async (e) => {
            e.preventDefault();
            console.log('Form submitted');
            const name = document.getElementById('name').value;
            const classVal = document.getElementById('class').value;
            const section = document.getElementById('section').value || 'N/A';
            const scholarNo = document.getElementById('scholarNo').value;

            if (!name || !classVal || !scholarNo) {
                alert('Please fill in all required fields: Name, Class, and Scholar Number.');
                return;
            }

            if (!(await validateScholarNo())) {
                alert('Invalid scholar number!');
                return;
            }

            const filteredPosts = posts.filter(post => !post.classSpecific || post.classSpecific === classVal);
            const postsData = {};
            let allSelected = true;

            filteredPosts.forEach(post => {
                const select = document.getElementById(post.id);
                if (select && select.value) {
                    postsData[post.id.replace('post', '')] = select.value;
                } else {
                    allSelected = false;
                }
            });

            if (!allSelected) {
                alert('Please select a candidate for all positions.');
                return;
            }

            const classSection = `${classVal}${section !== 'N/A' ? section : ''}`;
            try {
                const voteQuery = query(collection(db, `classes/${classSection}/votes`), where('scholarNo', '==', scholarNo));
                const voteSnapshot = await getDocs(voteQuery);
                if (!voteSnapshot.empty) {
                    alert('You have already voted!');
                    return;
                }

                const voteRef = doc(db, `classes/${classSection}/votes`, scholarNo);
                await setDoc(voteRef, {
                    name,
                    section,
                    scholarNo,
                    posts: postsData,
                    timestamp: new Date()
                }, { merge: true });
                alert(`Thank you, ${name}! Your votes have been recorded.`);
                document.getElementById('voteForm').reset();
                updatePosts();
            } catch (error) {
                console.error('Vote submission error:', error);
                alert('Error submitting vote: ' + error.message);
            }
        });

        document.getElementById('class').addEventListener('change', updatePosts);
        document.getElementById('section').addEventListener('change', updatePosts);
        updatePosts();
    </script>
</body>
</html>
